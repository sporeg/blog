---
layout: post
title: SSD
date: 2016-03-14
categories: [study]
tags: [SSD]
fullview: 
shortinfo: 
description: SSD相关知识
comments: yes
thread: 4
---

## Flash

新型非易失性存储介质

较传统磁盘存储

*	更好的I/O性能
*	更低的能耗
*	更小的体积
*	更轻的质量
*	更强的抗摔性
*	...

![Flash](/images/ssd1.jpg)

### 特性

读写操作的基本单位是页

而擦除操作的基本单位是块

先擦后写

有限的Program/Erase次数

* SLC 100000次
* MLC 3000-5000次

### 工作原理

采用特殊的浮栅场效应管

**Field Effect Transistor，FET**

利用三极管的导通与不导通两种状态，分别用来表示1和0

![浮栅场效应管](/images/ssd2.jpg)

一般状态下，因为浮栅可以保存电荷，所以Flash具有了**非易失性**

另外，在一定的外加电压作用下，可以对浮栅进行充/放电荷，这就是所谓的**“电可擦除”**

### 分类

SLC(Single-Level Cell) VS MLC(Multi-Level Cell)

=========================================

|  | 性能 | 寿命 | 成本 | 容量 |
|:---:|:---:|:---:|:---:|:---:|
| SLC | 高 | 长 | 高 | 小 |
| MLC | 低 | 短 | 低 | 大 |

=========================================

**NOR Flash VS NAND Flash**

*	性能
	*	NOR的读速度比NAND稍快一些 
	*	NAND的写入速度和擦除比NOR快很多
*	容量和成本
	*	NAND的单元尺寸几乎是NOR的一半
	*	NAND生产过程更为简单，容量更大，成本更低
*	可靠性
	*	NAND可擦写次数大概是NOR的十倍

## SSD

固态盘(Solid State Disk，SSD)

> “A solid state drive (SSD) is a * semiconductor-based * block storage device that behaves as a * virtual HDD * and appears to the host device as disk drive.”

### 分类

#### 基于DRAM的固态盘

读写速度快

但需要独立的电源来保持数据安全

需要备份硬盘来长久地存储数据 

#### 基于Flash的固态盘

数据能够持久保持，掉电也能保持数据

### 优势

*	抗震动
	*	没有机械部件
*	低能耗
	*	不需要马达
*	高性能
	*	使用闪存
*	体积小
*	质量轻

随机读性能好

### SSD组织结构

#### 硬件结构

![SSD硬件结构](/images/ssd3.jpg)

#### Flash芯片内部结构

![Flash芯片内部结构](/images/ssd4.jpg)

#### 软件结构

![SSD软件结构](/images/ssd5.jpg)

SSD是以硬盘的替代者的姿态出现，为了与现有系统无缝对接，SSD必须对外提供的是块接口，作为主机端，所看到的SSD是一个和HDD一样的块设备。

为了达到模拟块设备的目的，SSD中需要FTL作为中间层

#### FTL: Flash Translation Layer

FTL从主机文件系统接收块级请求（LSN, size），经过FTL的处理，产生flash的各种控制命令

FTL由三部分组成：

**Address mapping (地址映射)**

上层文件系统发送给SSD的任何读写命令包括两个部分（LSN，size）

LSN是逻辑扇区号，对于文件系统而言，它所看到的存储空间是一个线性的连续空间。

> 例如，读请求（260，6）表示的是需要读取从扇区号为260的逻辑扇区开始，总共6个扇区。

请求到达SSD后，需要经过地址转换，将逻辑扇区号转换成NAND FLASH中的物理页号<package，die，plane，block，page>

映射方式有很多种，常用的有三种：

*	页映射
	*	页映射性能最好，但映射表过大
*	块映射
	*	块映射减小了映射表，任何一个逻辑块可以映射到任何一个物理块，但逻辑页在逻辑块中的相对位置在物理块中保存不变，导致了找到这种物理页的概率变低，还容易造成碎片，性能低
*	混合映射
	*	混合映射是一种折衷的方式，利用日志块来保存更新的数据

=========================================

|  | 性能 | 寿命 | 映射表大小 | 所需内存大小 | 成本 |
|:---:|:---:|:---:|:---:|:---:|:---:|
| 页映射 | 好 | 长 | 大 | 大 | 高 |
| 块映射 | 差 | 短 | 小 | 小 | 低 |
| 混合映射 | 较差 | 较短 | 较小 | 较小 | 较低 | 

=========================================

**Wear leveling (磨损均衡)**

*	动态磨损均衡
	*	在请求到达时，选取擦除次数较少的块作为请求的物理地址。
*	静态磨损均衡
	*	在运行一段时间后，有些块存放的数据一直没有更新（冷数据），而有些块的数据经常性的更新（热数据）。那些存放冷数据的块的擦除次数远小于存放热数据的块。将冷数据从原块取出，存放在擦除次数过多的块，原来存放冷数据的块被释放出来，接受热数据的擦写。

**Garbage collection (垃圾回收)**

SSD在使用过程中，会产生大量失效页，在SSD的容量到达一定阈值时，需要调用GC函数，清除所有失效页，以增加可用空间。

### 问题

*	小写性能偏低
*	逻辑块与物理块映射的问题（页、块、混合映射）
*	SSD中flash芯片的磨损/寿命问题
*	SSD的后台操作
*	SSD的块接口（SATA接口限制了SSD性能）
*	...